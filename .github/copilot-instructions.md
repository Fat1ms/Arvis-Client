# Arvis AI Assistant ¬∑ Copilot Guide

## üéØ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è
- **–í–µ—Ä—Å–∏—è**: v1.5.1 (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤ `version.py`)
- **NO CRITICAL CHANGES** –±–µ–∑ —Ç—â–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –§–æ–∫—É—Å –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –±–∞–≥–æ–≤, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —É–ª—É—á—à–µ–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ**: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ (`utils/update_checker.py`)

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Arvis

–ü—Ä–æ–µ–∫—Ç Arvis —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **–¥–≤—É—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤**:

### 1. **Arvis-Client** (—ç—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: https://github.com/Fat1ms/Arvis-Client

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Desktop –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî –≥–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º AI

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**:
- **UI**: PyQt5 (–±–µ–∑—Ä–∞–º–æ—á–Ω–æ–µ –æ–∫–Ω–æ, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã)
- **STT**: Vosk (–æ—Ñ–ª–∞–π–Ω —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏, —Ä—É—Å—Å–∫–∏–π/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- **TTS**: Silero (–æ—Ñ–ª–∞–π–Ω —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏)
- **LLM**: Ollama (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –º–æ–¥–µ–ª–µ–π)
- **–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: SQLite –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: RBAC, 2FA (TOTP), audit logging

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
```
Arvis-Client/
‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ core/arvis_core.py    # –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ gui/                   # PyQt5 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ modules/                   # STT, TTS, LLM, –º–æ–¥—É–ª–∏ —Ñ—É–Ω–∫—Ü–∏–π
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ async_manager.py      # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ fast_http.py          # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ security/             # RBAC, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, audit
‚îú‚îÄ‚îÄ config/config.json        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ data/                     # –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

**–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã**:
- **–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–ª–∞–π–Ω, –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ì–∏–±—Ä–∏–¥–Ω—ã–π**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Arvis-Server —Å fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î

### 2. **Arvis-Server** (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: https://github.com/Fat1ms/Arvis-Server

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**:
- **Framework**: FastAPI (async REST API)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (–æ—Å–Ω–æ–≤–Ω–∞—è) / SQLite (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: JWT —Ç–æ–∫–µ–Ω—ã (60 –º–∏–Ω –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: bcrypt (–ø–∞—Ä–æ–ª–∏), CORS, rate limiting
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: Swagger UI (`/docs`)

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
- ‚úÖ JWT-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å refresh —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚úÖ RBAC –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ API
- ‚úÖ 2FA —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ TOTP)
- ‚úÖ –ê—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ Health check —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- ‚úÖ **Client API** - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (v1.0.0+)

**API —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**:
```
Arvis-Server/
‚îú‚îÄ‚îÄ main.py                      # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                 # Admin API: –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ users.py                # Admin API: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ client.py               # üÜï Client API: —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ models/                      # Pydantic –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ database/                    # SQLAlchemy ORM
‚îú‚îÄ‚îÄ security/                    # JWT, bcrypt, permissions
‚îî‚îÄ‚îÄ config.py                    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
```

**–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**:

#### Admin API (`/api/*`) - –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
```http
# –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
POST   /api/auth/login              # –í—Ö–æ–¥ (username, password ‚Üí JWT)
POST   /api/auth/logout             # –í—ã—Ö–æ–¥
POST   /api/auth/refresh            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
POST   /api/auth/verify-2fa         # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2FA –∫–æ–¥–∞
GET    /api/auth/check-permission   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—Ç—Ä–µ–±—É–µ—Ç admin)
GET    /api/users/                  # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
POST   /api/users/                  # –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /api/users/{user_id}         # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
PUT    /api/users/{user_id}         # –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DELETE /api/users/{user_id}         # –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
GET    /api/health                  # –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
GET    /version                     # –í–µ—Ä—Å–∏—è API
```

#### üÜï Client API (`/api/client/*`) - –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
```http
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ (–±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
GET    /api/client/server-info      # –í–µ—Ä—Å–∏—è —Å–µ—Ä–≤–µ—Ä–∞, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

# –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
POST   /api/client/login            # –í—Ö–æ–¥ (username, password ‚Üí JWT + user + permissions)
POST   /api/client/register         # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /api/client/validate-token   # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ (—Ç—Ä–µ–±—É–µ—Ç Bearer token)

# –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç Bearer token)
GET    /api/client/profile          # –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
PUT    /api/client/profile          # –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å (full_name, email)
PUT    /api/client/change-password  # –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å

# –†–∞–∑—Ä–µ—à–µ–Ω–∏—è (—Ç—Ä–µ–±—É–µ—Ç Bearer token)
GET    /api/client/my-permissions   # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
POST   /api/client/check-permissions # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
```

**–û—Ç–ª–∏—á–∏—è Client API –æ—Ç Admin API**:
| –§—É–Ω–∫—Ü–∏—è | Admin API | Client API |
|---------|-----------|------------|
| –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | ‚úÖ `/api/auth/login` | ‚úÖ `/api/client/login` (+ permissions –≤ –æ—Ç–≤–µ—Ç–µ) |
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | ‚ùå | ‚úÖ `/api/client/register` |
| –ü—Ä–æ—Ñ–∏–ª—å | ‚úÖ `/api/auth/me` | ‚úÖ `/api/client/profile` + update |
| –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è | ‚ùå | ‚úÖ `/api/client/change-password` |
| –†–∞–∑—Ä–µ—à–µ–Ω–∏—è | ‚úÖ `/api/auth/check-permission` | ‚úÖ `/api/client/my-permissions` (–≤—Å–µ —Å—Ä–∞–∑—É) |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ | ‚úÖ `/api/users/*` | ‚ùå (—Ç–æ–ª—å–∫–æ admin API) |
| –¢—Ä–µ–±—É–µ–º—ã–µ –ø—Ä–∞–≤–∞ | Admin –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ | User –¥–ª—è –≤—Å–µ—Ö |

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫):
- Username: `admin`
- Password: `ChangeMeOnFirstRun123!`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** (–Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ):
```json
// config/config.json
{
  "security": {
    "auth": {
      "use_remote_server": true,
      "server_url": "http://192.168.0.130:8000"
    }
  }
}
```

**–í–∞–∂–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**:
- üîí **–°–µ—Ä–≤–µ—Ä –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ** ‚Äî –∏–∑–±–µ–≥–∞–π—Ç–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üîÑ **–ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî –∫–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- üì° **API –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `logs/audit/*.jsonl`

## üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- **`main.py`**: –°–æ–∑–¥–∞—ë—Ç `ArvisApp` ‚Üí Qt application ‚Üí splash screen ‚Üí `MainWindow` ‚Üí login dialog ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **`src/gui/main_window.py`**: –ë–µ–∑—Ä–∞–º–æ—á–Ω–æ–µ –æ–∫–Ω–æ, –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç `ChatPanel`, `StatusPanel`, `OrbitWidget`
- **`src/core/arvis_core.py`**: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–æ–∑–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç STT, TTS, LLM, –º–æ–¥—É–ª—è–º–∏, –∏—Å—Ç–æ—Ä–∏–µ–π, RBAC

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```python
# ArvisCore.__init__ ‚Üí init_components_async()
# –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ (–≤ –ø–æ—Ç–æ–∫–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è UI):
1. LLMClient (–±—ã—Å—Ç—Ä–æ)
2. TTSEngine (–º–µ–¥–ª–µ–Ω–Ω–æ, –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å subprocess)
3. STTEngine (–º–µ–¥–ª–µ–Ω–Ω–æ, –∑–∞–≥—Ä—É–∂–∞–µ—Ç Vosk –º–æ–¥–µ–ª—å)
4. KaldiWakeWordDetector (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ stt.wake_word_engine="kaldi")
5. –ú–æ–¥—É–ª–∏: WeatherModule, NewsModule, SystemControlModule, CalendarModule, SearchModule
```

**–í–∞–∂–Ω–æ**: –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ Qt —Å–∏–≥–Ω–∞–ª—ã –î–û –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (—Å–º. `init_components_async` ‚Üí –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ `stt_instance.speech_recognized` –ø–µ—Ä–µ–¥ `self.stt_engine = stt_instance`).

## üîÑ –ö–ª—é—á–µ–≤—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí ChatPanel.send_message()
  ‚Üì
ArvisCore.process_message(text)
  ‚Üì (RBAC –ø—Ä–æ–≤–µ—Ä–∫–∞: Permission.CHAT_USE)
  ‚Üì
handle_module_commands(text) ‚Äî –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ –∫–æ–º–∞–Ω–¥—É (–ø–æ–≥–æ–¥–∞, –Ω–æ–≤–æ—Å—Ç–∏ –∏ —Ç.–¥.)
  ‚Üì –µ—Å–ª–∏ –Ω–µ –º–æ–¥—É–ª—å ‚Üí
LLMClient.stream_response() ‚Äî —Å—Ç—Ä–∏–º–∏–Ω–≥ –æ—Ç Ollama
  ‚Üì (–±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –≤ _stream_buffer_text, ‚â•20 —Å–∏–º–≤–æ–ª–æ–≤)
  ‚Üì
partial_response.emit() ‚Üí ChatPanel –æ–±–Ω–æ–≤–ª—è–µ—Ç UI
  ‚Üì
TTSEngine.speak_streaming(chunk) ‚Äî –æ–∑–≤—É—á–∏–≤–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
  ‚Üì
response_ready.emit() ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ConversationHistory
```

### –ì–æ–ª–æ—Å–æ–≤–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è (wake word)
```
1. KaldiWakeWordDetector (–∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Vosk) —Å–ª—É—à–∞–µ—Ç "–ê—Ä–≤–∏—Å/Jarvis"
2. wake_word_detected.emit()
3. ArvisCore._on_wake_word_detected():
   - –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–¢ wake word detection
   - –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫—É—é —Ñ—Ä–∞–∑—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ("–°–ª—É—à–∞—é")
   - _speak_and_start_recording_after_tts() ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç –∑–∞–ø–∏—Å—å –ø–æ—Å–ª–µ TTS
4. STTEngine.speech_recognized.emit(text)
5. ArvisCore.process_voice_input(text):
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –ø—Ä–æ—Å—Ç–æ –ª–∏ –∏–º—è ("–ê—Ä–≤–∏—Å" –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã)
   - –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ ‚Üí process_message(text)
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç wake word detection –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ**: Wake word detection –ù–ï –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ –≤—Ä–µ–º—è TTS –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ (—Å–º. `_on_wake_word_detected` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ `self._is_tts_playing` –∏ `self.is_processing`).

### TTS –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∏ —Å—Ç—Ä–∏–º–∏–Ω–≥
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞**: 20 —Å–∏–º–≤–æ–ª–æ–≤ –∏–ª–∏ –≥—Ä–∞–Ω–∏—Ü–∞ —Å–ª–æ–≤–∞ (`. , ! ? ; : \n`)
- **Subprocess fallback**: `modules/tts_worker_subprocess.py` –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ—Ä–∞–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**: `_prime_name_ack_cache_async()` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ –¥–ª—è "–°–ª—É—à–∞—é", "–î–∞?" –∏ —Ç.–¥. –≤ —Ñ–æ–Ω–µ

## üîê –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (RBAC + 2FA)

### –†–æ–ª–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
```python
# utils/security/rbac.py
Role.GUEST      ‚Üí –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ (—á–∞—Ç, –ø–æ–≥–æ–¥–∞, –Ω–æ–≤–æ—Å—Ç–∏)
Role.USER       ‚Üí —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∞ (+ –º–æ–¥—É–ª–∏, –∏—Å—Ç–æ—Ä–∏—è, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã)
Role.POWER_USER ‚Üí —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ (+ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞, —Å–∫—Ä–∏–ø—Ç—ã, –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç)
Role.ADMIN      ‚Üí –í–°–ï —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (+ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –≤ –∫–æ–¥–µ
```python
from utils.security import get_rbac_manager, require_permission, Permission

# –î–µ–∫–æ—Ä–∞—Ç–æ—Ä
@require_permission(Permission.SYSTEM_SHUTDOWN)
def shutdown_system():
    os.system("shutdown /s /t 0")

# –Ø–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
rbac = get_rbac_manager()
rbac.set_current_user(user_id)
rbac.set_role(user.role)
if not rbac.has_permission(Permission.MODULE_WEATHER):
    raise PermissionError("Access denied")
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–≥–∏–±—Ä–∏–¥–Ω–∞—è)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–µ—Ç—ã—Ä—ë—Ö —É—Ä–æ–≤–Ω–µ–π** (–æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ v1.5.1+):
1. **`utils/security/hybrid_auth.py`**: –ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–∂–∏–º (Client API ‚Üí Admin API ‚Üí –ª–æ–∫–∞–ª—å–Ω–æ)
2. **`utils/security/client_api.py`**: üÜï REST API –∫–ª–∏–µ–Ω—Ç –¥–ª—è Client API (`/api/client/*`) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±
3. **`utils/security/remote_auth_client.py`**: REST API –∫–ª–∏–µ–Ω—Ç –¥–ª—è Admin API (`/api/*`) ‚Äî fallback –¥–ª—è admin —Ñ—É–Ω–∫—Ü–∏–π
4. **`utils/security/local_auth.py`**: –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ SQLite (`data/users.db`) ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π fallback

**–ü–æ—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** (–æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ v1.5.1+):
```
GUI (LoginDialog) 
  ‚Üì
HybridAuthManager.authenticate(username, password)
  ‚Üì
1. –ü—Ä–æ–±—É–µ—Ç ArvisClientAPI.login() ‚Üí /api/client/login
   ‚Üì (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º)
   ‚úÖ JWT —Ç–æ–∫–µ–Ω + user data + permissions ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ session
   ‚Üì (–µ—Å–ª–∏ Client API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
2. Fallback #1: RemoteAuthClient.login() ‚Üí /api/auth/login (Admin API)
   ‚Üì (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω)
   ‚úÖ JWT —Ç–æ–∫–µ–Ω + user data ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ session
   ‚Üì (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
3. Fallback #2: LocalAuth.authenticate() ‚Üí data/users.db
   ‚Üì
   ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Å—Å–∏—è + user data
```

**–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä**:
```
UserManagementDialog.create_user()
  ‚Üì
HybridAuthManager.create_user()
  ‚Üì
1. RemoteAuthClient.create_user() ‚Üí POST /api/users/ (—Ç—Ä–µ–±—É–µ—Ç admin token)
   ‚Üì (—É—Å–ø–µ—à–Ω–æ)
   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   ‚Üì (—Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
2. Fallback: LocalAuth.create_user() ‚Üí data/users.db
   ‚Üì
   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ
```

**–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã**:
```python
# –¢–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è prod)
config.json: {"auth": {"use_remote_server": true}}
‚Üí –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Arvis-Server, fallback –æ—Ç–∫–ª—é—á–µ–Ω

# –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ (–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º)
config.json: {"auth": {"use_remote_server": false}}
‚Üí –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ SQLite, —Å–µ—Ä–≤–µ—Ä –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

# –ì–∏–±—Ä–∏–¥–Ω—ã–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
config.json: {"auth": {"use_remote_server": true}}
‚Üí –ü—Ä–æ–±—É–µ—Ç —Å–µ—Ä–≤–µ—Ä, –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ ‚Üí –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î
```

**2FA –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**:
- **TOTP**: `utils/security/totp_manager.py` (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–æ–≤)
- **UI**: `src/gui/two_factor_setup_dialog.py`, `src/gui/two_factor_verification_dialog.py`
- **Backup –∫–æ–¥—ã**: –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ 2FA, —Ö—Ä–∞–Ω—è—Ç—Å—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: 2FA –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —Ç–∞–∫ –∏ –ª–æ–∫–∞–ª—å–Ω–æ

**Audit logging**: `utils/security/audit.py` ‚Üí `logs/audit/*.jsonl` (—Ä–æ—Ç–∞—Ü–∏—è 10 –ú–ë, 90 –¥–Ω–µ–π TTL)

## üõ†Ô∏è –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º Qt UI)
```python
from utils.async_manager import task_manager

def heavy_task():
    # –î–æ–ª–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è...
    return result

def on_complete(task_id, result):
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ UI –ø–æ—Ç–æ–∫–µ
    self.update_ui(result)

def on_error(task_id, error):
    self.show_error(error)

task_manager.run_async(
    "my_task_id", 
    heavy_task,
    on_complete=on_complete,
    on_error=on_error
)
```

**–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–π—Ç–µ** –¥–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (STT, TTS, HTTP) –Ω–∞–ø—Ä—è–º—É—é –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö Qt —Å–æ–±—ã—Ç–∏–π!

### HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Ollama
```python
from utils.fast_http import FastHTTPClient

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç localhost ‚Üí 127.0.0.1 (–∏–∑–±–µ–≥–∞–µ–º IPv6 –∑–∞–≤–∏—Å–∞–Ω–∏–π)
client = FastHTTPClient("http://localhost:11434", timeout=5.0)
result = client.get("/api/tags")  # –ö–µ—à–∏—Ä—É–µ—Ç—Å—è 5 —Å–µ–∫—É–Ω–¥
```

### –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (i18n)
```python
from i18n import _, apply_to_widget_tree

# –í –∫–æ–¥–µ
label.setText(_("–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!"))

# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–∑—ã–∫–∞
new_lang = "en"
I18N.get().set_language(new_lang)
apply_to_widget_tree(self)  # –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Å—å –≤–∏–¥–∂–µ—Ç –¥–µ—Ä–µ–≤–æ
```

–í—Å–µ UI —Å—Ç—Ä–æ–∫–∏ **–¥–æ–ª–∂–Ω—ã** –±—ã—Ç—å –æ–±—ë—Ä–Ω—É—Ç—ã –≤ `_()`.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **`config/config.json`**: –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å `.env` —á–µ—Ä–µ–∑ `config/config.py`)
- **–°–µ–∫—Ä–µ—Ç—ã**: `.env` —Ñ–∞–π–ª (API –∫–ª—é—á–∏, —Ç–æ–∫–µ–Ω—ã)
- **Wake words**: `stt.kaldi_wake_words` (—Å–ø–∏—Å–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è)

```python
from config.config import Config
config = Config()
value = config.get("llm.default_model", "auto")
config.set("modules.voice_activation_enabled", True)
```

### –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
```python
from utils.conversation_history import ConversationHistory

history = ConversationHistory(config)
history.add_message("user", "–ü—Ä–∏–≤–µ—Ç")
history.add_message("assistant", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!")
# –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ data/conversation_history.json
# –¢—Ä–∏–º–º–∏—Ç—Å—è –¥–æ 50 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π
```

## üß™ –†–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Windows)
```bat
# –ü–µ—Ä–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
INSTALL.bat

# –ó–∞–ø—É—Å–∫
LAUNCH.bat

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
venv\Scripts\activate
python main.py
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: Python 3.11 –∏–ª–∏ 3.12 (PyAudio –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å 3.13!)

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bat
diagnose_setup.bat       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
diagnose_performance.bat # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU/RAM/GPU
STATUS.bat               # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
ollama_manager.bat       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Ollama —Å–µ—Ä–≤–µ—Ä–æ–º
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# Unit —Ç–µ—Å—Ç—ã
pytest tests/

# –ì–æ–ª–æ—Å–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
python tests\debug_test.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ –ª–∏–Ω—Ç–∏–Ω–≥ (–ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º)
pre-commit run --all-files
```

**–ü—Ä–∞–≤–∏–ª–æ**: –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º!

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è
1. –°–æ–∑–¥–∞—Ç—å `modules/my_module.py` —Å –∫–ª–∞—Å—Å–æ–º `MyModule(config)`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `ArvisCore.init_modules()`:
   ```python
   self.my_module = MyModule(self.config)
   ```
3. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ `ArvisCore.handle_module_commands()`:
   ```python
   if "–∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ" in message.lower():
       if self.rbac.has_permission(Permission.MODULE_MY):
           return self.my_module.process(message)
       else:
           raise PermissionError("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω")
   ```
4. –û–±–Ω–æ–≤–∏—Ç—å `utils/security/rbac.py` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å `Permission.MODULE_MY` –≤ –º–∞—Ç—Ä–∏—Ü—É —Ä–æ–ª–µ–π

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –ª–æ–≤—É—à–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. IPv6 –∑–∞–≤–∏—Å–∞–Ω–∏—è —Å localhost
**–ü—Ä–æ–±–ª–µ–º–∞**: `localhost` —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –≤ `::1` –∏ –≤–∏—Å–Ω–µ—Ç –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö Windows.
**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `127.0.0.1` –∏–ª–∏ `FastHTTPClient` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç).

```python
# ‚ùå –ü–ª–æ—Ö–æ
url = "http://localhost:11434"

# ‚úÖ –•–æ—Ä–æ—à–æ
url = "http://127.0.0.1:11434"
# –∏–ª–∏
from utils.fast_http import FastHTTPClient
client = FastHTTPClient("http://localhost:11434")  # –ê–≤—Ç–æ–∑–∞–º–µ–Ω–∞ –≤–Ω—É—Ç—Ä–∏
```

### 2. –î–æ–ª–≥–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Vosk –º–æ–¥–µ–ª–∏
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª–Ω–∞—è –º–æ–¥–µ–ª—å `vosk-model-ru-0.22` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è ~2 –º–∏–Ω—É—Ç—ã.
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `vosk-model-small-ru-0.22` –¥–ª—è wake word detection, –ø–æ–ª–Ω—É—é ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è STT.

```json
// config.json
{
  "stt": {
    "model_path": "models/vosk-model-ru-0.22",
    "kaldi_model_path": "models/vosk-model-small-ru-0.22",
    "wake_word_engine": "kaldi"
  }
}
```

### 3. TTS –±–ª–æ–∫–∏—Ä—É–µ—Ç UI
**–ü—Ä–æ–±–ª–µ–º–∞**: –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å —Å–µ–∫—É–Ω–¥—ã –∏ –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
**–†–µ—à–µ–Ω–∏–µ**: TTS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `task_manager.run_async()`, –Ω–æ –¥–ª—è –æ—Å–æ–±–æ –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –µ—Å—Ç—å subprocess fallback.

```python
# TTSEngine –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–π –º–µ—Ç–æ–¥
tts_engine.speak(text)  # –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π
```

### 4. Wake word –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–ª—É—à–∞—Ç—å –≤–æ –≤—Ä–µ–º—è TTS
**–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è, –∫–æ–≥–¥–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å–ª—ã—à–∏—Ç —Å–µ–±—è.
**–†–µ—à–µ–Ω–∏–µ**: `_on_wake_word_detected()` **–í–°–ï–ì–î–ê** –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç wake word detection –ø–µ—Ä–µ–¥ TTS, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Å–ª–µ.

```python
# –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ wake word
wake_word_detector.stop_detection()
# ... TTS –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ ...
QTimer.singleShot(600, lambda: self._restart_wake_listening_if_enabled())
```

### 5. Audit –ª–æ–≥–∏ —Ä–∞–∑—Ä–∞—Å—Ç–∞—é—Ç—Å—è
**–ü—Ä–æ–±–ª–µ–º–∞**: `logs/audit/*.jsonl` –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞.
**–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è (10 –ú–ë) –∏ –æ—á–∏—Å—Ç–∫–∞ (90 –¥–Ω–µ–π) —á–µ—Ä–µ–∑ `utils/housekeeping.py`.

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config.json`:
```json
{
  "audit": {
    "enabled": true,
    "max_log_size": 10485760,
    "max_log_age_days": 90
  }
}
```

### 6. PyInstaller —Å–±–æ—Ä–∫–∞
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å**: –°–±–æ—Ä–æ—á–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (—Å–º. —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `build_exe.bat` –≤ –∫–æ–¥–µ)
**–í–∞–∂–Ω–æ**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∫–ª—é—á–∏—Ç–µ –≤ –ø–∞–∫–µ—Ç `models/`, `config/`, `UXUI/`, `data/` (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤!)

```bat
pyinstaller --onefile --windowed --add-data "models;models" main.py
```

## üÜï –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
utils/update_checker.py ‚Üí GitHub Releases API
  ‚Üì (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ version.py —Å latest release)
  ‚Üì –µ—Å–ª–∏ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è ‚Üí
–°–∫–∞—á–∏–≤–∞–Ω–∏–µ ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
  ‚Üì
–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ‚Üí –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  ‚Üì (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞)
Rollback –∏–∑ –±—ç–∫–∞–ø–∞
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ —á–µ—Ä–µ–∑ `task_manager`
- **–°–æ–≥–ª–∞—Å–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: UI –¥–∏–∞–ª–æ–≥ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: `data/`, `config/`, `logs/` –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è
- **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å**: SHA256 —Ö–µ—à–∏ –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: `config.json` ‚Üí `auto_update.enabled`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **[CLIENT_API_INTEGRATION.md](docs/CLIENT_API_INTEGRATION.md)**: üÜï –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Client API —Å–µ—Ä–≤–µ—Ä–∞ (v1.5.1+)
- **[CLIENT_API_README.md](docs/CLIENT_API_README.md)**: üÜï –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ Client API
- **[CLIENT_API_CHANGELOG.md](docs/CLIENT_API_CHANGELOG.md)**: üÜï Changelog –∏ –º–∏–≥—Ä–∞—Ü–∏—è

### –ü—Ä–æ—á–µ–µ (–µ—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- **RBAC_GUIDE.md**: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **USER_MANAGEMENT_GUIDE.md**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **USER_GUIDE_2FA.md**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **SECURITY_AUDIT_REPORT.md**: –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üî• –ü—Ä–∞–≤–∏–ª–∞ –∫–æ–º–º–∏—Ç–æ–≤

1. **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç**: `pytest tests/` ‚Äî –∑–µ–ª—ë–Ω—ã–π
2. **Pre-commit —Ö—É–∫–∏**: `pre-commit run --all-files` –±–µ–∑ –æ—à–∏–±–æ–∫
3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ù–µ –ª–æ–º–∞–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **–ú–∞–ª–µ–Ω—å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**: –õ—É—á—à–µ 5 –∫–æ–º–º–∏—Ç–æ–≤ –ø–æ 50 —Å—Ç—Ä–æ–∫, —á–µ–º 1 –Ω–∞ 250 —Å—Ç—Ä–æ–∫
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–∏—Ç–µ CHANGELOG.md –∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ `.md` —Ñ–∞–π–ª—ã

## üéì –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
```python
from src.core.arvis_core import ArvisCore

core = ArvisCore(config)
core.process_message("–ü—Ä–∏–≤–µ—Ç, –ê—Ä–≤–∏—Å!")
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
from utils.security import get_rbac_manager, Permission, Role

rbac = get_rbac_manager()
rbac.set_role(Role.USER)
if rbac.has_permission(Permission.SYSTEM_SHUTDOWN):
    print("–ú–æ–∂–µ—Ç –≤—ã–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É")
```

### –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
from utils.security import get_auth_manager, Role

auth = get_auth_manager()
user = auth.create_user(
    username="ivan",
    password="SecurePass123!",
    role=Role.USER
)
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```python
from utils.async_manager import task_manager

def fetch_data():
    # –î–æ–ª–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
    return {"result": "success"}

task_manager.run_async(
    "fetch_task",
    fetch_data,
    on_complete=lambda tid, res: print(f"–ì–æ—Ç–æ–≤–æ: {res}")
)
```

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 2.0 (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 08.10.2025)  
**–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤**: –°–º. [CONTRIBUTING.md](CONTRIBUTING.md) –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ issue –Ω–∞ GitHub
