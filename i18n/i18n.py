from typing import Dict, Optional

from PyQt5.QtWidgets import QCheckBox, QComboBox, QGroupBox, QLabel, QLineEdit, QPushButton, QWidget


class I18N:
    """Simple i18n manager for runtime UI language switching without .qm files.
    Provides dictionary-based translations and utilities to translate Qt widgets.
    """

    _instance: Optional["I18N"] = None

    def __init__(self, lang: str = "ru"):
        self.lang = lang
        self._translations: Dict[str, Dict[str, str]] = {}
        self._build_defaults()

    @classmethod
    def get(cls) -> "I18N":
        if cls._instance is None:
            cls._instance = I18N()
        return cls._instance

    def set_language(self, lang: str):
        self.lang = lang or "ru"

    def t(self, text: str) -> str:
        if not text:
            return text
        table = self._translations.get(self.lang) or {}
        return table.get(text, text)

    def _build_defaults(self):
        # Base English translations
        en: Dict[str, str] = {
            # Common
            "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Arvis": "Arvis Settings",
            "–ù–∞—Å—Ç—Ä–æ–π–∫–∏": "Settings",
            "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å": "Save",
            "–û—Ç–º–µ–Ω–∞": "Cancel",
            "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å": "Save and Restart",
            # Sections
            "–û–±—â–∏–µ": "General",
            "LLM": "LLM",
            "TTS | STT": "TTS | STT",
            "–Ø–∑—ã–∫": "Language",
            "–ú–æ–¥—É–ª–∏": "Modules",
            "–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ": "Advanced",
            # General tab
            "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å": "User",
            "–ò–º—è:": "Name:",
            "–ì–æ—Ä–æ–¥:": "City:",
            "–ó–∞–ø—É—Å–∫": "Startup",
            "–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ Ollama": "Autostart Ollama",
            "–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏": "Preload model",
            "–°–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –≤ —Ç—Ä–µ–π": "Minimize to tray",
            "–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ Arvis –≤–º–µ—Å—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π": "Start Arvis with system",
            # LLM tab
            "URL —Å–µ—Ä–≤–µ—Ä–∞:": "Server URL:",
            "–ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:": "Default model:",
            "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è": "Generation",
            "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:": "Temperature:",
            "–ú–∞–∫—Å. —Ç–æ–∫–µ–Ω–æ–≤:": "Max tokens:",
            "–í—ã–≤–æ–¥ –æ—Ç–≤–µ—Ç–∞": "Output",
            "–†–µ–∂–∏–º:": "Mode:",
            "–†–µ–∞–ª—å–Ω—ã–π —Å—Ç—Ä–∏–º": "Real streaming",
            "–°–∏–º—É–ª—è—Ü–∏—è (–ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)": "Simulation (after generation)",
            "–û—Ç–∫–ª—é—á–µ–Ω–æ": "Disabled",
            # TTS/STT
            "Text-to-Speech": "Text-to-Speech",
            "–î–≤–∏–∂–æ–∫:": "Engine:",
            "–ì–æ–ª–æ—Å:": "Voice:",
            "–ß–∞—Å—Ç–æ—Ç–∞:": "Sample rate:",
            "–†–µ–∂–∏–º –æ–∑–≤—É—á–∫–∏:": "TTS mode:",
            "–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (—Å—Ç—Ä–∏–º)": "Realtime (stream)",
            "–ü–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º": "Sentence by sentence",
            "–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è": "After complete",
            "–û–∑–≤—É—á–∏–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç": "Speak generated text",
            "–†–∞–∑—Ä–µ—à–∏—Ç—å SAPI (Windows) –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç": "Allow SAPI (Windows) as fallback",
            "Speech-to-Text": "Speech-to-Text",
            "–°–ª–æ–≤–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:": "Wake word:",
            "–ü—É—Ç—å –∫ –º–æ–¥–µ–ª–∏:": "Model path:",
            "–û–±–∑–æ—Ä...": "Browse...",
            # Language tab
            "–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞": "UI language",
            "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:": "Interface:",
            "–†–µ—á—å (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏ –æ–∑–≤—É—á–∫–∞)": "Speech (STT/TTS)",
            "–†–µ—á—å (STT/TTS):": "Speech (STT/TTS):",
            "–°–∫–∞—á–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª–∏ Vosk –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞": "Download/Update Vosk models for selected language",
            "–ú–æ–¥–µ–ª–∏ Vosk": "Vosk models",
            "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏": "Download error",
            # Modules
            "API –ö–ª—é—á–∏": "API Keys",
            "OpenWeather:": "OpenWeather:",
            "NewsAPI:": "NewsAPI:",
            "–ú–æ–¥—É–ª–∏": "Modules",
            "–ú–æ–¥—É–ª—å –ø–æ–≥–æ–¥—ã": "Weather module",
            "–ú–æ–¥—É–ª—å –Ω–æ–≤–æ—Å—Ç–µ–π": "News module",
            "–ú–æ–¥—É–ª—å –∫–∞–ª–µ–Ω–¥–∞—Ä—è": "Calendar module",
            "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π": "System control",
            "–ì–æ–ª–æ—Å–æ–≤–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è": "Voice activation",
            # Advanced
            "–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ": "Logging",
            "–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤:": "Log level:",
            "–ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª": "Write logs to file",
            "–ü—É—Ç–∏": "Paths",
            "–ü–∞–ø–∫–∞ –ª–æ–≥–æ–≤:": "Logs folder:",
            "–ü–∞–ø–∫–∞ –º–æ–¥–µ–ª–µ–π:": "Models folder:",
            "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞–º–∏": "Logs management",
            "–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏": "Clear old logs",
            "–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏, –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏": "Delete all logs except current session",
            "–û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤": "Clear logs",
            "–ü–∞–ø–∫–∞ –ª–æ–≥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.": "Logs folder not found.",
            "–£–¥–∞–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤: ": "Deleted log files: ",
            "–¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞.": "Current session preserved.",
            "–û—à–∏–±–∫–∞": "Error",
            # ChatPanel tooltips and labels
            "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...": "Type a message...",
            "–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥": "Voice input",
            "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ": "Send message",
            "–û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å": "Cancel current request",
            "–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç": "Clear chat",
            "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ–ª–æ—Å": "Stop voice",
            "–ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å –æ—Ä–±": "Show/Hide orb",
            "–ù–∞—Å—Ç—Ä–æ–π–∫–∏": "Settings",
            "–ú–∏–∫—Ä–æ—Ñ–æ–Ω –∞–∫—Ç–∏–≤–µ–Ω": "Microphone active",
            "Arvis –ø–µ—á–∞—Ç–∞–µ—Ç‚Ä¶": "Arvis is typing‚Ä¶",
            "Arvis –¥—É–º–∞–µ—Ç‚Ä¶": "Arvis is thinking‚Ä¶",
            "–ß–∞—Ç –æ—á–∏—â–µ–Ω. –ö–∞–∫ –¥–µ–ª–∞?": "Chat cleared. How are you?",
            "–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤": "Chat history",
            "–í—Å–µ–≥–æ": "Total",
            "–û—Ç –≤–∞—Å": "From you",
            "–û—Ç Arvis": "From Arvis",
            "üîç –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏...": "Search history...",
            "–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫": "Clear search",
            "–≠–∫—Å–ø–æ—Ä—Ç": "Export",
            "–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é": "Clear history",
            "–ó–∞–∫—Ä—ã—Ç—å": "Close",
            "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏": "Failed to load history",
            "üì≠ –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞": "History is empty",
            "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É: {query}": "No results for: {query}",
            "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é": "Export history",
            "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª": "Export history to a text file",
            "–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã (*.txt);;–í—Å–µ —Ñ–∞–π–ª—ã (*)": "Text files (*.txt);;All files (*)",
            "–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω": "Export complete",
            "–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤:\n{path}": "History saved to:\n{path}",
            "–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞": "Export error",
            "–ù–µ —É–¥–∞–ª–æ—Å—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é:\n{error}": "Could not export history:\n{error}",
            "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ": "Confirmation",
            "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é?\n\n–¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è –±—É–¥–µ—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –≤:\n{path}": "Are you sure you want to clear history?\n\nThe session will be archived to:\n{path}",
            "–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞": "History cleared",
            "–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω–∞ –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞": "History cleared and archived",
            "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é (—Å –∞—Ä—Ö–∏–≤–∞—Ü–∏–µ–π)": "Clear entire history (with archiving)",
            "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é:\n{error}": "Failed to clear history:\n{error}",
            "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫": "Positive ratings",
            "–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫": "Negative ratings",
            "üë§ –í—ã": "üë§ You",
            "ü§ñ Arvis": "ü§ñ Arvis",
            "üëç –•–æ—Ä–æ—à–∏–π –æ—Ç–≤–µ—Ç": "üëç Good response",
            "üëé –ü–ª–æ—Ö–æ–π –æ—Ç–≤–µ—Ç": "üëé Poor response",
            "‚úì –û—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç: –•–æ—Ä–æ—à–∏–π –æ—Ç–≤–µ—Ç": "Feedback saved: good response",
            "‚úó –û—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç: –ü–ª–æ—Ö–æ–π –æ—Ç–≤–µ—Ç": "Feedback saved: poor response",
            "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É.": "Couldn't save feedback.",
            "–ò—Å—Ç–æ—Ä–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞": "History unavailable",
            "–°–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ –µ—â—ë –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.": "Chat history system isn't ready yet.\nPlease wait.",
            "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é:\n{error}": "Couldn't open history:\n{error}",
            "üîé –ò—Å—Ç–æ—á–Ω–∏–∫–∏:": "üîé Sources:",
            "–ò—Å—Ç–æ—á–Ω–∏–∫": "Source",
            "Google Search API:": "Google Search API:",
            "ID –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (CX):": "Search engine ID (CX):",
            "–í–µ–±-–ø–æ–∏—Å–∫ Google": "Google Web Search",
        }

        es: Dict[str, str] = {
            "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Arvis": "Configuraci√≥n de Arvis",
            "–ù–∞—Å—Ç—Ä–æ–π–∫–∏": "Configuraci√≥n",
            "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å": "Guardar",
            "–û—Ç–º–µ–Ω–∞": "Cancelar",
            "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å": "Guardar y reiniciar",
            "–û–±—â–∏–µ": "General",
            "–Ø–∑—ã–∫": "Idioma",
            "–ú–æ–¥—É–ª–∏": "M√≥dulos",
            "–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ": "Avanzado",
            # ... (short set for demo)
            "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...": "Escribe un mensaje...",
            "–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤": "Historial de chat",
            "–í—Å–µ–≥–æ": "Total",
            "–û—Ç –≤–∞—Å": "De ti",
            "–û—Ç Arvis": "De Arvis",
            "üîç –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏...": "Buscar en el historial...",
            "–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫": "Limpiar b√∫squeda",
            "–≠–∫—Å–ø–æ—Ä—Ç": "Exportar",
            "–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é": "Borrar historial",
            "–ó–∞–∫—Ä—ã—Ç—å": "Cerrar",
            "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏": "Error al cargar el historial",
            "üì≠ –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞": "El historial est√° vac√≠o",
            "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É: {query}": "No se encontr√≥ nada para: {query}",
            "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é": "Exportar historial",
            "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª": "Exportar historial a un archivo de texto",
            "–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã (*.txt);;–í—Å–µ —Ñ–∞–π–ª—ã (*)": "Archivos de texto (*.txt);;Todos los archivos (*)",
            "–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω": "Exportaci√≥n completada",
            "–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤:\n{path}": "Historial guardado en:\n{path}",
            "–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞": "Error de exportaci√≥n",
            "–ù–µ —É–¥–∞–ª–æ—Å—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é:\n{error}": "No se pudo exportar el historial:\n{error}",
            "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ": "Confirmaci√≥n",
            "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é?\n\n–¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è –±—É–¥–µ—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –≤:\n{path}": "¬øSeguro que quieres borrar el historial?\n\nLa sesi√≥n se archivar√° en:\n{path}",
            "–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞": "Historial borrado",
            "–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω–∞ –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞": "Historial borrado y archivado",
            "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é (—Å –∞—Ä—Ö–∏–≤–∞—Ü–∏–µ–π)": "Borrar todo el historial (con archivo)",
            "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é:\n{error}": "No se pudo borrar el historial:\n{error}",
            "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫": "Valoraciones positivas",
            "–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫": "Valoraciones negativas",
            "üë§ –í—ã": "üë§ T√∫",
            "ü§ñ Arvis": "ü§ñ Arvis",
            "üëç –•–æ—Ä–æ—à–∏–π –æ—Ç–≤–µ—Ç": "üëç Buena respuesta",
            "üëé –ü–ª–æ—Ö–æ–π –æ—Ç–≤–µ—Ç": "üëé Mala respuesta",
            "‚úì –û—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç: –•–æ—Ä–æ—à–∏–π –æ—Ç–≤–µ—Ç": "Comentario guardado: buena respuesta",
            "‚úó –û—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç: –ü–ª–æ—Ö–æ–π –æ—Ç–≤–µ—Ç": "Comentario guardado: mala respuesta",
            "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É.": "No se pudo guardar el comentario.",
            "–ò—Å—Ç–æ—Ä–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞": "Historial no disponible",
            "–°–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ –µ—â—ë –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.": "El historial a√∫n no est√° listo.\nPor favor, espera.",
            "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é:\n{error}": "No se pudo abrir el historial:\n{error}",
            "üîé –ò—Å—Ç–æ—á–Ω–∏–∫–∏:": "üîé Fuentes:",
            "–ò—Å—Ç–æ—á–Ω–∏–∫": "Fuente",
            "Google Search API:": "Google Search API:",
            "ID –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (CX):": "ID del motor de b√∫squeda (CX):",
            "–í–µ–±-–ø–æ–∏—Å–∫ Google": "B√∫squeda web de Google",
        }

        uk: Dict[str, str] = {
            "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Arvis": "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Arvis",
            "–ù–∞—Å—Ç—Ä–æ–π–∫–∏": "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è",
            "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å": "–ó–±–µ—Ä–µ–≥—Ç–∏",
            "–û—Ç–º–µ–Ω–∞": "–°–∫–∞—Å—É–≤–∞—Ç–∏",
            "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å": "–ó–±–µ—Ä–µ–≥—Ç–∏ —ñ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏",
            "–û–±—â–∏–µ": "–ó–∞–≥–∞–ª—å–Ω—ñ",
            "–Ø–∑—ã–∫": "–ú–æ–≤–∞",
            "–ú–æ–¥—É–ª–∏": "–ú–æ–¥—É–ª—ñ",
            "–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ": "–†–æ–∑—à–∏—Ä–µ–Ω—ñ",
            "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...": "–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...",
            "–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤": "–Ü—Å—Ç–æ—Ä—ñ—è —Ä–æ–∑–º–æ–≤",
            "–í—Å–µ–≥–æ": "–í—Å—å–æ–≥–æ",
            "–û—Ç –≤–∞—Å": "–í—ñ–¥ –≤–∞—Å",
            "–û—Ç Arvis": "–í—ñ–¥ Arvis",
            "üîç –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏...": "–ü–æ—à—É–∫ –ø–æ —ñ—Å—Ç–æ—Ä—ñ—ó...",
            "–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫": "–û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ—à—É–∫",
            "–≠–∫—Å–ø–æ—Ä—Ç": "–ï–∫—Å–ø–æ—Ä—Ç",
            "–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é": "–û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é",
            "–ó–∞–∫—Ä—ã—Ç—å": "–ó–∞–∫—Ä–∏—Ç–∏",
            "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏": "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó",
            "üì≠ –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞": "–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ—Ä–æ–∂–Ω—è",
            "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É: {query}": "–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∑–∞ –∑–∞–ø–∏—Ç–æ–º: {query}",
            "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é": "–ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é",
            "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª": "–ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é —É —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª",
            "–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã (*.txt);;–í—Å–µ —Ñ–∞–π–ª—ã (*)": "–¢–µ–∫—Å—Ç–æ–≤—ñ —Ñ–∞–π–ª–∏ (*.txt);;–£—Å—ñ —Ñ–∞–π–ª–∏ (*)",
            "–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω": "–ï–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ",
            "–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤:\n{path}": "–Ü—Å—Ç–æ—Ä—ñ—é –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤:\n{path}",
            "–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞": "–ü–æ–º–∏–ª–∫–∞ –µ–∫—Å–ø–æ—Ä—Ç—É",
            "–ù–µ —É–¥–∞–ª–æ—Å—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é:\n{error}": "–ù–µ –≤–¥–∞–ª–æ—Å—è –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é:\n{error}",
            "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ": "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è",
            "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é?\n\n–¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è –±—É–¥–µ—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –≤:\n{path}": "–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—é —ñ—Å—Ç–æ—Ä—ñ—é?\n\n–°–µ—Å—ñ—é –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ –∞—Ä—Ö—ñ–≤:\n{path}",
            "–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞": "–Ü—Å—Ç–æ—Ä—ñ—é –æ—á–∏—â–µ–Ω–æ",
            "–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω–∞ –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞": "–Ü—Å—Ç–æ—Ä—ñ—é –æ—á–∏—â–µ–Ω–æ –π –∑–∞–∞—Ä—Ö—ñ–≤–æ–≤–∞–Ω–æ",
            "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é (—Å –∞—Ä—Ö–∏–≤–∞—Ü–∏–µ–π)": "–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—é —ñ—Å—Ç–æ—Ä—ñ—é (–∑—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º)",
            "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é:\n{error}": "–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é:\n{error}",
            "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫": "–ü–æ–∑–∏—Ç–∏–≤–Ω–∏—Ö –æ—Ü—ñ–Ω–æ–∫",
            "–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫": "–ù–µ–≥–∞—Ç–∏–≤–Ω–∏—Ö –æ—Ü—ñ–Ω–æ–∫",
            "üë§ –í—ã": "üë§ –í–∏",
            "ü§ñ Arvis": "ü§ñ Arvis",
            "üëç –•–æ—Ä–æ—à–∏–π –æ—Ç–≤–µ—Ç": "üëç –•–æ—Ä–æ—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å",
            "üëé –ü–ª–æ—Ö–æ–π –æ—Ç–≤–µ—Ç": "üëé –ü–æ–≥–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å",
            "‚úì –û—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç: –•–æ—Ä–æ—à–∏–π –æ—Ç–≤–µ—Ç": "–í—ñ–¥–≥—É–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–æ: —Ö–æ—Ä–æ—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å",
            "‚úó –û—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç: –ü–ª–æ—Ö–æ–π –æ—Ç–≤–µ—Ç": "–í—ñ–¥–≥—É–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–æ: –ø–æ–≥–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å",
            "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É.": "–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–±–µ—Ä–µ–≥—Ç–∏ –æ—Ü—ñ–Ω–∫—É.",
            "–ò—Å—Ç–æ—Ä–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞": "–Ü—Å—Ç–æ—Ä—ñ—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞",
            "–°–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ –µ—â—ë –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.": "–°–∏—Å—Ç–µ–º—É —ñ—Å—Ç–æ—Ä—ñ—ó —â–µ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ.\n–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞—á–µ–∫–∞–π—Ç–µ.",
            "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é:\n{error}": "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é:\n{error}",
            "üîé –ò—Å—Ç–æ—á–Ω–∏–∫–∏:": "üîé –î–∂–µ—Ä–µ–ª–∞:",
            "–ò—Å—Ç–æ—á–Ω–∏–∫": "–î–∂–µ—Ä–µ–ª–æ",
            "Google Search API:": "Google Search API:",
            "ID –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (CX):": "–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –ø–æ—à—É–∫–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ (CX):",
            "–í–µ–±-–ø–æ–∏—Å–∫ Google": "–ü–æ—à—É–∫ Google",
        }

        # Russian is identity mapping (optional)
        ru: Dict[str, str] = {}

        self._translations = {
            "en": en,
            "es": es,
            "uk": uk,
            "ru": ru,
        }


# Shorthand for translating string literals


def _(text: str) -> str:
    return I18N.get().t(text)


def apply_to_widget_tree(root: QWidget):
    """Translate titles, texts, tooltips and combo items for a widget subtree."""
    t = I18N.get().t

    def translate_widget(w: QWidget):
        try:
            # Window title
            if hasattr(w, "windowTitle") and callable(getattr(w, "windowTitle")):
                title = w.windowTitle()
                if isinstance(title, str) and title:
                    w.setWindowTitle(t(title))

            if isinstance(w, QLabel):
                txt = w.text()
                if txt:
                    w.setText(t(txt))
                tip = w.toolTip()
                if tip:
                    w.setToolTip(t(tip))
            elif isinstance(w, QPushButton):
                txt = w.text()
                if txt:
                    w.setText(t(txt))
                tip = w.toolTip()
                if tip:
                    w.setToolTip(t(tip))
            elif isinstance(w, QGroupBox):
                w.setTitle(t(w.title()))
            elif isinstance(w, QCheckBox):
                txt = w.text()
                if txt:
                    w.setText(t(txt))
                tip = w.toolTip()
                if tip:
                    w.setToolTip(t(tip))
            elif isinstance(w, QLineEdit):
                ph = w.placeholderText()
                if ph:
                    w.setPlaceholderText(t(ph))
                tip = w.toolTip()
                if tip:
                    w.setToolTip(t(tip))
            elif isinstance(w, QComboBox):
                tip = w.toolTip()
                if tip:
                    w.setToolTip(t(tip))
                for i in range(w.count()):
                    w.setItemText(i, t(w.itemText(i)))
        except Exception:
            pass

    def walk(widget: QWidget):
        translate_widget(widget)
        for child in widget.findChildren(QWidget):
            walk(child)

    if root is not None:
        walk(root)
