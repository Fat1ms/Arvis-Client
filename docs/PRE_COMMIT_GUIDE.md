# Pre-commit Hooks - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## üéØ –ß—Ç–æ —ç—Ç–æ?

Pre-commit hooks –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–∞—à –∫–æ–¥ **–ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º**, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –ø–æ–ø–∞–¥–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pre-commit

```bash
pip install pre-commit
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ö—É–∫–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
cd d:\AI\Arvis
pre-commit install
```

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º `git commit` –±—É–¥—É—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∏.

## ‚úÖ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

- ‚ú® **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - Black –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–¥
- üì¶ **–ò–º–ø–æ—Ä—Ç—ã** - isort —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏–º–ø–æ—Ä—Ç—ã
- üêõ **–õ–∏–Ω—Ç–∏–Ω–≥** - flake8 –Ω–∞—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∏ —Å—Ç–∏–ª—è
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - Bandit –∏ detect-secrets –∏—â—É—Ç —É—è–∑–≤–∏–º–æ—Å—Ç–∏
- üìù **–§–∞–π–ª—ã** - –ø—Ä–æ–≤–µ—Ä–∫–∞ trailing whitespace, YAML, JSON
- üîç **–¢–∏–ø—ã** - mypy –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏—é

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û–±—ã—á–Ω—ã–π –∫–æ–º–º–∏—Ç

```bash
git add .
git commit -m "feat: add new feature"
```

Pre-commit –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∏:

- ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ü–æ–∫–∞–∂–µ—Ç –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)

### –ï—Å–ª–∏ —Ö—É–∫–∏ –Ω–∞—à–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ê–≤—Ç–æ-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** - –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö —Å–Ω–æ–≤–∞:

   ```bash
   git add <–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ_—Ñ–∞–π–ª—ã>
   git commit -m "feat: add new feature"
   ```

2. **–û—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞** - –∏—Å–ø—Ä–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é:

   ```bash
   # –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤ –≤—ã–≤–æ–¥–µ pre-commit
   # –ò—Å–ø—Ä–∞–≤—å—Ç–µ –∫–æ–¥
   git add <–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ_—Ñ–∞–π–ª—ã>
   git commit -m "feat: add new feature"
   ```

### –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é (–±–µ–∑ –∫–æ–º–º–∏—Ç–∞)

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã
pre-commit run --all-files

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã
pre-commit run --files src/gui/main_window.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ö—É–∫
pre-commit run black --all-files
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –û–±–Ω–æ–≤–∏—Ç—å —Ö—É–∫–∏

```bash
pre-commit autoupdate
```

### –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö—É–∫–∏ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è!)

```bash
# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –í–°–ï —Ö—É–∫–∏
git commit -m "message" --no-verify

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
$env:SKIP = "black,flake8"
git commit -m "message"
```

‚ö†Ô∏è **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞—è—Ö!**

### –£–¥–∞–ª–∏—Ç—å —Ö—É–∫–∏

```bash
pre-commit uninstall
```

## üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `.pre-commit-config.yaml`:

```yaml
repos:
  - repo: https://github.com/psf/black
    rev: 24.1.1
    hooks:
      - id: black
        args: [--line-length=120]  # –ò–∑–º–µ–Ω–∏—Ç—å –¥–ª–∏–Ω—É —Å—Ç—Ä–æ–∫–∏
```

## üí° –°–æ–≤–µ—Ç—ã

### 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –º–µ–¥–ª–µ–Ω–Ω—ã–π

```bash
# –ü–µ—Ä–≤—ã–π —Ä–∞–∑ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤—Å–µ —Ö—É–∫–∏ (1-2 –º–∏–Ω—É—Ç—ã)
pre-commit run --all-files
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∫–æ–º–º–∏—Ç—ã –±—É–¥—É—Ç –±—ã—Å—Ç—Ä—ã–º–∏ (5-10 —Å–µ–∫—É–Ω–¥).

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ IDE

**VS Code:**

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: Python, Black Formatter
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

### 3. CI –∏ pre-commit

Pre-commit —Ö—É–∫–∏ —Ç–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ CI (GitHub Actions), –ø–æ—ç—Ç–æ–º—É:

- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ –ø—Ä–æ—à–ª–æ ‚Üí –≤ CI —Ç–æ–∂–µ –ø—Ä–æ–π–¥—ë—Ç
- ‚ùå –õ–æ–∫–∞–ª—å–Ω–æ —É–ø–∞–ª–æ ‚Üí –∏—Å–ø—Ä–∞–≤—å—Ç–µ –¥–æ push

### 4. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

–í `.pre-commit-config.yaml` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:

```yaml
exclude: |
  (?x)^(
      venv/.*|
      models/.*|
      logs/.*|
      ...
  )$
```

## ‚ùì FAQ

**Q: Pre-commit —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–π**
A: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –º–µ–¥–ª–µ–Ω–Ω—ã–π (—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–π). –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ ‚Äî –±—ã—Å—Ç—Ä—ã–µ. –û—Ç–∫–ª—é—á–∏—Ç–µ mypy, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω.

**Q: Black –∏–∑–º–µ–Ω–∏–ª –º–æ–π –∫–æ–¥!**
A: –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. Black —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–¥ –ø–æ PEP 8. –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ.

**Q: –ö–∞–∫ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ö—É–∫ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞?**
A: –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–æ–¥:

```python
# noqa: F401  - –¥–ª—è flake8
# type: ignore  - –¥–ª—è mypy
```

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ Git?**
A: –î–∞, –∫–æ–º–∞–Ω–¥–∞ `pre-commit run --all-files` —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –±–µ–∑ –∫–æ–º–º–∏—Ç–∞.

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://pre-commit.com/)
- [–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö—É–∫–æ–≤](https://pre-commit.com/hooks.html)
- [Black –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://black.readthedocs.io/)
- [flake8 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://flake8.pycqa.org/)

---

**–°–æ–≤–µ—Ç:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `pre-commit run --all-files` **–ø—Ä—è–º–æ —Å–µ–π—á–∞—Å**, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã!
