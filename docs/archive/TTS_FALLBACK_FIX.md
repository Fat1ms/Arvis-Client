# TTS Fix Summary (v1.5.2)

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **TTS Factory —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π**
–ü–µ—Ä–µ–ø–∏—Å–∞–Ω `modules/tts_factory.py` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ fallback:

```
Silero (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1) 
  ‚Üì [–µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞]
Bark (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
  ‚Üì [–µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞]
SAPI5 (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3, Windows –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π)
```

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `TTSFactory.create_engine_with_fallback()` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å fallback
- `TTSFactory.list_available_engines()` - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–≤–∏–∂–∫–æ–≤
- `TTSFactory.get_engine_info()` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–≤–∏–∂–∫–µ
- –ü–æ–ª–Ω–∞—è support –¥–ª—è health check –∫–∞–∂–¥–æ–≥–æ –¥–≤–∏–∂–∫–∞

### 2. **SAPI5 TTS Engine**
–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å `modules/system_tts.py` (SAPITTSEngine) - Windows –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–µ–∑:

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `pyttsx3` (—É–¥–æ–±–Ω—ã–π API, –≤—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
- Fallback –Ω–∞ `win32com` SAPI –ø—Ä—è–º–æ–µ API
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–º, —Å–∫–æ—Ä–æ—Å—Ç—å—é, –≥—Ä–æ–º–∫–æ—Å—Ç—å—é
- –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å TTSEngineBase

**–ì–æ–ª–æ—Å–∞:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≥–æ–ª–æ—Å–∞ Windows (Irina, Zira, David –∏ —Ç.–¥.)

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**

**requirements.txt:**
- ‚úÖ `bark-ml>=0.1.0` - Bark TTS —Å–∏–Ω—Ç–µ–∑
- ‚úÖ `pyttsx3>=2.90` - SAPI fallback
- ‚úÖ `vosk==0.3.45` - —Ä–µ—á–µ–≤–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
- ‚úÖ `torch`, `torchaudio` - –¥–ª—è Silero/Bark

### 4. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

**config.json:**
```json
{
  "tts": {
    "default_engine": "silero",
    "engines_priority": ["silero", "bark", "sapi"],
    "fallback_on_error": true,
    "engines": {
      "silero": {
        "enabled": true,
        "description": "Fast, offline, Russian support"
      },
      "bark": {
        "enabled": true,
        "model_size": "small",
        "description": "Quality, multilingual"
      },
      "sapi5": {
        "enabled": true,
        "rate": 150,
        "volume": 100,
        "description": "Windows system TTS"
      }
    }
  }
}
```

### 5. **–û–±–Ω–æ–≤–ª–µ–Ω INSTALL.bat**

–î–æ–±–∞–≤–ª–µ–Ω–∞:
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ Silero –º–æ–¥–µ–ª–∏ (100-200MB) –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫ Bark (–±–æ–ª—å—à–∞—è –º–æ–¥–µ–ª—å, lazy loading)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚ö†Ô∏è PyAudio (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –º–æ–∂–µ—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –Ω–∞ 3.13)

### 6. **–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç**

–°–æ–∑–¥–∞–Ω `test_tts_fallback_chain.py`:
```bash
python test_tts_fallback_chain.py
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–≤–∏–∂–∫–∏
2. Health status –∫–∞–∂–¥–æ–≥–æ
3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—É—é —Ü–µ–ø–æ—á–∫—É
4. –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏

---

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç TTS —Ç–µ–ø–µ—Ä—å

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–≤ ArvisCore)
```python
from modules.tts_factory import TTSFactory

# –°–æ–∑–¥–∞—Ç—å TTS —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback
tts_engine = TTSFactory.create_engine_with_fallback(
    engine_names=None,  # –ò—Å–ø–æ–ª—å–∑—É–µ–º config.tts.engines_priority
    config=config,
    logger=logger
)
```

### –í–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```python
# –û–∑–≤—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç (–≤—ã–±–µ—Ä–µ—Ç –ª—É—á—à–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–≤–∏–∂–æ–∫)
tts_engine.speak("–ü—Ä–∏–≤–µ—Ç –º–∏—Ä!")

# –ü–æ—Ç–æ–∫–æ–≤—ã–π —Å–∏–Ω—Ç–µ–∑ (–¥–ª—è streaming –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç LLM)
tts_engine.speak_streaming("–≠—Ç–æ ")
tts_engine.speak_streaming("–ø–æ—Ç–æ–∫–æ–≤—ã–π ")
tts_engine.speak_streaming("—Å–∏–Ω—Ç–µ–∑.")
tts_engine.flush_buffer()

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
tts_engine.stop()
```

### Fallback –≤ –¥–µ–π—Å—Ç–≤–∏–∏
1. **–ü–æ–ø—ã—Ç–∫–∞ Silero** ‚Üí –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–Ω–µ—Ç torch, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏ —Ç.–¥.)
2. **–ü–æ–ø—ã—Ç–∫–∞ Bark** ‚Üí –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞/–∑–∞–≥—Ä—É–∂–µ–Ω–∞
3. **–ò—Å–ø–æ–ª—å–∑—É–µ–º SAPI5** ‚Üí Windows –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π, –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω

–ö–∞–∂–¥—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è.

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
```json
{
  "tts": {
    "engines_priority": ["bark", "silero", "sapi"]  // Bark –ø–µ—Ä–≤—ã–º
  }
}
```

### –û—Ç–∫–ª—é—á–∏—Ç—å –¥–≤–∏–∂–æ–∫
```json
{
  "tts": {
    "engines": {
      "silero": {
        "enabled": false  // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å Silero
      }
    }
  }
}
```

### SAPI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```json
{
  "tts": {
    "sapi": {
      "rate": 150,      // –°–∫–æ—Ä–æ—Å—Ç—å: 50-200
      "volume": 100,    // –ì—Ä–æ–º–∫–æ—Å—Ç—å: 0-100
      "voice": null     // null = —Å–∏—Å—Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }
  }
}
```

### Bark –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```json
{
  "tts": {
    "bark": {
      "voice": "v2/multilingual_00",  // –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞
      "model_size": "small"            // small –∏–ª–∏ full
    }
  }
}
```

---

## üß™ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
INSTALL.bat
```

–ó–∞–≥—Ä—É–∑–∏—Ç:
- ‚úÖ Python 3.11/3.12 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ Silero –º–æ–¥–µ–ª—å (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ ~2-5 –º–∏–Ω)
- ‚úÖ Bark (lazy load, –Ω–∞ –ø–µ—Ä–≤—ã–π —Å–∏–Ω—Ç–µ–∑)
- ‚úÖ pyttsx3 (fallback)

### 2. –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ TTS
```bash
python test_tts_fallback_chain.py
```

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
LAUNCH.bat
```

---

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Silero –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
python -c "import torch; torch.hub.load('snakers4/silero-models', 'silero_tts', language='ru', speaker='v3_1_ru')"
```

### Bark –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! Bark –±–æ–ª—å—à–∞—è –º–æ–¥–µ–ª—å. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `model_size: "small"` –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

```json
{
  "tts": {
    "bark": {
      "model_size": "small"  // –ú–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏ –∏ –±—ã—Å—Ç—Ä–µ–µ
    }
  }
}
```

### SAPI5 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pyttsx3:
```bash
pip install pyttsx3
```

–ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ fallback –Ω–∞ Silero/Bark.

### Python 3.13 + PyAudio
PyAudio –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å 3.13. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Python 3.11 –∏–ª–∏ 3.12.

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `modules/tts_factory.py` | ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π fallback |
| `modules/system_tts.py` | ‚úÖ **–ù–û–í–´–ô** - SAPI5 TTS Engine |
| `requirements.txt` | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã bark-ml, pyttsx3 |
| `config/config.json` | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã engines_priority, SAPI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `INSTALL.bat` | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ Silero –º–æ–¥–µ–ª–∏ |
| `test_tts_fallback_chain.py` | ‚úÖ **–ù–û–í–´–ô** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ |

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ TTS

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Arvis TTS Fallback Chain (v1.5.2)   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ 1Ô∏è‚É£  SILERO (Primary)                ‚îÇ
‚îÇ     ‚Ä¢ Fast (~1-3 —Å–µ–∫/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)  ‚îÇ
‚îÇ     ‚Ä¢ Russian + English              ‚îÇ
‚îÇ     ‚Ä¢ Offline                        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ     ‚Üì [if unavailable]              ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ 2Ô∏è‚É£  BARK (Secondary)                ‚îÇ
‚îÇ     ‚Ä¢ Quality, multilingual          ‚îÇ
‚îÇ     ‚Ä¢ Slower (~5-10 —Å–µ–∫)             ‚îÇ
‚îÇ     ‚Ä¢ Offline                        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ     ‚Üì [if unavailable]              ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ 3Ô∏è‚É£  SAPI5 (Fallback)               ‚îÇ
‚îÇ     ‚Ä¢ Windows native TTS             ‚îÇ
‚îÇ     ‚Ä¢ Always available              ‚îÇ
‚îÇ     ‚Ä¢ System voices                 ‚îÇ
‚îÇ                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

**–í–µ—Ä—Å–∏—è**: 1.5.2  
**–î–∞—Ç–∞**: 26.10.2025  
**–°—Ç–∞—Ç—É—Å**: Production-ready ‚úÖ
